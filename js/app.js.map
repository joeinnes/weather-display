{"version":3,"sources":["app/app.js"],"names":["fetchJsonp","require","fetch","getLocation","Promise","resolve","reject","navigator","geolocation","getCurrentPosition","position","lat","coords","latitude","long","longitude","getWeather","baseUrl","apiKey","window","then","data","json","catch","err","getPlaceImage","loc","google","maps","LatLng","map","Map","document","createElement","center","zoom","request","location","radius","service","places","PlacesService","nearbySearch","results","status","PlacesServiceStatus","OK","photoUrl","photos","getUrl","e","console","error","all","conditions","current_observation","image","display_location","full","locationInfo","resp","page","query","pages","extract","updateView","weather","city","state_name","temp_c","handleError","country","temperature","getElementById","style","backgroundImage","innerText","display"],"mappings":"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","file":"public/js/app.js","sourcesContent":["/* globals google, fetchJsonp */\nconst fetchJsonp = require('fetch-jsonp')\nconst fetch = require('whatwg-fetch')\n\nfunction getLocation () {\n  return new Promise((resolve, reject) => {\n    if ('geolocation' in navigator) {\n      navigator.geolocation.getCurrentPosition((position) => {\n        let lat = position.coords.latitude\n        let long = position.coords.longitude\n        resolve([lat, long])\n      })\n    } else {\n      reject('Unable to get location')\n    }\n  })\n}\n\nfunction getWeather (lat, long) {\n  return new Promise((resolve, reject) => {\n    let baseUrl = 'https://api.wunderground.com/api'\n    let apiKey = '06b04f2180c628f8'\n    window.fetch(`${baseUrl}/${apiKey}/conditions/q/${lat},${long}.json`)\n      .then((data) => data.json())\n      .then((data) => {\n        resolve(data)\n      })\n      .catch((err) => {\n        reject(err)\n      })\n  })\n}\n\nfunction getPlaceImage (lat, long) {\n  return new Promise((resolve, reject) => {\n    let loc = new google.maps.LatLng(lat, long)\n    let map = new google.maps.Map(document.createElement('div'), {\n      center: loc,\n      zoom: 15\n    })\n    let request = {\n      location: loc,\n      radius: '2500'\n    }\n    let service = new google.maps.places.PlacesService(map)\n    service.nearbySearch(request, (results, status) => {\n      try {\n        if (status === google.maps.places.PlacesServiceStatus.OK) {\n          let photoUrl = results[0].photos[0].getUrl({'maxWidth': 2000, 'maxHeight': 2000})\n          resolve(photoUrl)\n        } else {\n          resolve('https://source.unsplash.com/random')\n        }\n      } catch (e) {\n        console.error(e)\n        resolve('https://source.unsplash.com/random')\n      }\n    })\n  })\n}\n\ngetLocation()\n  .then((data) => {\n    return Promise.all([getWeather(data[0], data[1]), getPlaceImage(data[0], data[1])])\n      .then((data) => {\n        let conditions = data[0].current_observation\n        let image = data[1]\n        fetchJsonp('https://en.wikipedia.org/w/api.php?format=json&action=query&generator=search&gsrnamespace=0&gsrlimit=1&prop=extracts&exintro&explaintext&exsentences=5&exlimit=max&redirects=1&gsrsearch=' + conditions.display_location.full)\n          .then((locationInfo) => locationInfo.json())\n          .then((locationInfo) => {\n            let resp = ''\n            for (let page in locationInfo.query.pages) {\n              resp = locationInfo.query.pages[page].extract\n            }\n            return resp\n          })\n          .then((locationInfo) => {\n            updateView(\n              conditions.weather,\n              conditions.display_location.city,\n              conditions.display_location.state_name,\n              conditions.temp_c,\n              locationInfo + '\\n\\nPowered by Weather Underground, Wikipedia, Google, and Tachyons. Loading cubes by Tobias Ahlin.',\n              image\n            )\n          })\n          .catch((err) => {\n            handleError(err)\n          })\n      })\n      .catch((err) => {\n        handleError(err)\n      })\n  })\n  .catch((err) => {\n    handleError(err)\n  })\n\nfunction updateView (weather, city, country, temperature, extract, image) {\n  document.getElementById('background').style.backgroundImage = 'url(\\'' + image + '\\')'\n  document.getElementById('city').innerText = weather + ' in ' + city + ' (' + temperature + 'Â°C)'\n  document.getElementById('country-or-state').innerText = country\n  document.getElementById('location-info').innerText = extract\n  document.getElementById('loading').style.display = 'none'\n  document.getElementById('article').style.display = 'block'\n}\n\nfunction handleError (err) {\n  document.getElementById('error-message').innerText = 'Technical details: ' + err\n  document.getElementById('loading').style.display = 'none'\n  document.getElementById('error').style.display = 'block'\n}\n"]}